# RC file to ensure proper PATH for npm/npx
rc: ./.lefthookrc

# commit-msg:
#   commands:
#     commitlint:
#       run: npx --no -- commitlint --edit {1}

# EXAMPLE USAGE:
#
#   Refer for explanation to following link:
#   https://github.com/evilmartians/lefthook/blob/master/docs/configuration.md
#
# pre-push:
#   commands:
#     eslint-audit:
#       tags: frontend eslint
#       run: npm run lint
#     typescript-audit:
#       tags: frontend typescript
#       run: npm run type-check

pre-commit:
  parallel: true
  commands:
    # Format frontend files (JS, TS, Vue, JSON, etc.) and root files
    prettier-format:
      glob: "*.{js,ts,jsx,tsx,vue,json,css,scss,md,yml,yaml}"
      run: npx prettier --write {staged_files}
      stage_fixed: true
      tags: format
    # Lint frontend files
    eslint-lint:
      root: "frontend/"
      glob: "*.{js,ts,vue}"
      run: npm run lint -- {staged_files}
      tags: lint frontend
    # Format backend Python files
    black-format:
      root: "backend/"
      glob: "*.py"
      run: (uv run black {staged_files} 2>/dev/null || .venv/bin/black {staged_files} 2>/dev/null || python3 -m black {staged_files})
      stage_fixed: true
      tags: format backend
    # Lint backend Python files (critical errors only in pre-commit)
    flake8-lint:
      root: "backend/"
      glob: "*.py"
      run: (uv run flake8 {staged_files} --count --select=E9,F63,F7,F82 --show-source --statistics 2>/dev/null || .venv/bin/flake8 {staged_files} --count --select=E9,F63,F7,F82 --show-source --statistics 2>/dev/null || python3 -m flake8 {staged_files} --count --select=E9,F63,F7,F82 --show-source --statistics)
      tags: lint backend
