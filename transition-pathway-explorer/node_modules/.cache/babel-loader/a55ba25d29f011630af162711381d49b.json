{"remainingRequest":"/Users/paruta/2050-Calculators/EUcalc/paris-tool/transition-pathway-explorer/node_modules/babel-loader/lib/index.js!/Users/paruta/2050-Calculators/EUcalc/paris-tool/transition-pathway-explorer/node_modules/eslint-loader/index.js??ref--13-0!/Users/paruta/2050-Calculators/EUcalc/paris-tool/transition-pathway-explorer/src/outputsService.js","dependencies":[{"path":"/Users/paruta/2050-Calculators/EUcalc/paris-tool/transition-pathway-explorer/src/outputsService.js","mtime":1707210098284},{"path":"/Users/paruta/2050-Calculators/EUcalc/paris-tool/transition-pathway-explorer/node_modules/cache-loader/dist/cjs.js","mtime":1707234519865},{"path":"/Users/paruta/2050-Calculators/EUcalc/paris-tool/transition-pathway-explorer/node_modules/babel-loader/lib/index.js","mtime":1707234519797},{"path":"/Users/paruta/2050-Calculators/EUcalc/paris-tool/transition-pathway-explorer/node_modules/eslint-loader/index.js","mtime":1707234519720}],"contextDependencies":[],"result":["import _slicedToArray from \"/Users/paruta/2050-Calculators/EUcalc/paris-tool/transition-pathway-explorer/node_modules/@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport Vue from \"vue\";\nimport * as helpers from \"./helpers.js\";\nimport { findNullstellen } from \"./chartSeriesBuilders.js\";\nimport * as dataService from \"./dataService.js\";\nimport { appState } from \"./dataService.js\";\nexport var tabs; // necessary for tab-menu and holding subtab information\n// the chart identifiers only need to be unique inside their tab\n\nexport var chartDefinitions = [];\nexport var outputsByTabs = []; // necessary for fetching\n\nexport var outputs = {}; // holding the API response data\n\nexport var netZeroYear = {\n  value: 0\n}; // made reactive in EmissionsBar.vue\n\nexport var routes = {}; // tab-indices of routes\n\nexport var tabRoutes = {}; // routes of tab-indices\n\nexport var warningsInfos = {};\nexport var warnings = {// // structure example:\n  // \"warningId\": \"orange\", //or 1/2\n  // development data:\n  // \"Water scarcity\": \"orange\",\n  // \"Drought risk\": \"red\"\n}; //reactive data!!\n//don't write warnings into tabs Object, keep it separate\n\nexport var tabsWithWarnings = []; //reactive\n\nexport var outputsThatAreAlwaysRequested = [\"clt_cum-emissions-CO2e[Mt]\", \"emissions-CO2e[Mt]\"];\nvar outputModifiers = {\n  round: function round(value) {\n    return Math.round(value);\n  }\n}; // countryzoom can also be disabled for an individual subtab with the countryZoomDisabled flag inside\n// the subtab definitions\n\nexport var zoomableComponents = ['OneChart', 'TwoCharts', 'GHGEmissions', 'ChangePerSector', 'WagesPerSkill' // 'SingleStackedArea',\n// 'SingleLineChart',\n// 'SingleStackedAreaWithNegative',\n// 'SingleStackedAreaPercent',\n// 'TwoStackedArea',\n// 'TwoStackedArea100Percent',\n// 'TwoStackedAreaSideBySide'\n];\nexport var chartTypeToComponentMap = {\n  \"Line\": \"LineChart\",\n  \"StackedArea\": \"StackedAreaChart\",\n  \"StackedAreaNegative\": \"StackedAreaChart\",\n  \"StackedAreaPercent\": \"StackedAreaChart100Percent\"\n};\nexport function getOutputList() {\n  var outputPoolObject = {};\n  chartDefinitions.forEach(function (tab) {\n    Object.keys(tab).forEach(function (chartId) {\n      var chart = tab[chartId]; // console.log('chart ', tab, chart);\n\n      chart.outputs.forEach(function (output) {\n        outputPoolObject[output.id] = true;\n      });\n    });\n  });\n  outputsThatAreAlwaysRequested.forEach(function (outp) {\n    outputPoolObject[outp] = true;\n  });\n  console.log(\"getOutputList \", JSON.stringify(Object.keys(outputPoolObject), null, 2));\n}\n\nfunction initChartsForTab(tabIndex, chartDefs) {\n  chartDefinitions[tabIndex] = {}; // outputsByTab need to hold at least en empty object for each tab\n\n  createRowInOutputsByTab(tabIndex);\n  Object.keys(chartDefs).forEach(function (chartId) {\n    var chart = chartDefs[chartId]; // convert output-string-array elements to objects\n\n    var outputs = [];\n    chart.outputs.forEach(function (outp) {\n      var output;\n\n      if (helpers.isObject(outp)) {\n        output = outp;\n      } else if (typeof outp === 'string') {\n        output = {\n          id: outp\n        };\n      }\n\n      if (!output) {\n        return;\n      }\n\n      sortOutputIntoOutputsByTabs(tabIndex, output);\n      outputs.push(output);\n    });\n    chart.outputs = outputs; // replace modifier string (if present) with modifier-function\n\n    if (chart.modifier) {\n      if (outputModifiers[chart.modifier]) {\n        chart.modifier = outputModifiers[chart.modifier];\n      } else {\n        delete chart.modifier;\n      }\n    } // add chart to chartDefinitions\n\n\n    chartDefinitions[tabIndex][chartId] = chart;\n  });\n}\n\nfunction createRowInOutputsByTab(tabIndex) {\n  outputsByTabs[tabIndex] = {};\n}\n\nfunction sortOutputIntoOutputsByTabs(tabIndex, outp) {\n  // don't overwrite existing entries (we don't want to lose any allCountries flags)\n  if (!outputsByTabs[tabIndex][outp.id]) {\n    outputsByTabs[tabIndex][outp.id] = {};\n  }\n\n  if (outp.allCountries === true) {\n    //won't be unset once it is set\n    outputsByTabs[tabIndex][outp.id].allCountries = true;\n  } // if(outp.color) {\n  //   outputsByTabs[tabIndex][outp.id].color = outp.color;\n  // }\n\n}\n\nfunction initSubtabsOfTab(subtabs) {\n  return subtabs.map(function (subtab) {\n    // don't overwrite existing component properties (these are for custom components)\n    if (!subtab.component) {\n      if (subtab.charts.length === 1) {\n        subtab.component = 'OneChart';\n      } else if (subtab.charts.length === 2) {\n        subtab.component = 'TwoCharts';\n      }\n    }\n\n    return subtab;\n  });\n}\n\nexport function initTabs(tabData, allTabDetails) {\n  tabs = [];\n  tabData.forEach(function (tab, tabIndex) {\n    var tabObj = {\n      title: tab.title,\n      route: tab.route,\n      subtabs: []\n    };\n    tabs.push(tabObj);\n    var detailsKey = tab.detailsKey;\n\n    if (!detailsKey) {\n      return;\n    } // get subtab-information\n\n\n    var tabDetails = allTabDetails[detailsKey];\n\n    if (!tabDetails) {\n      return;\n    } // init all charts for that tab (not subtab)\n\n\n    initChartsForTab(tabIndex, tabDetails.charts); // determine component for subtab\n\n    tabObj.subtabs = initSubtabsOfTab(tabDetails.subtabs);\n  });\n  console.log(\"initTabs\", tabs, outputsByTabs);\n}\nexport function initTabRoutes() {\n  tabs.forEach(function (tab, tabIndex) {\n    routes[tab.route] = {\n      index: tabIndex\n    };\n    tabRoutes[tabIndex] = {\n      \"route\": tab.route\n    };\n    tab.subtabs.forEach(function (subtab, subTabIndex) {\n      routes[tab.route][subtab.route] = {\n        index: subTabIndex\n      };\n      tabRoutes[tabIndex][subTabIndex] = {\n        \"route\": subtab.route\n      };\n    });\n  });\n}\nexport function initWarningsInfos(warningInfoData) {\n  console.log('initWarningsInfos ', warningInfoData); // warningsInfos = wrngs;\n\n  Object.keys(warningInfoData).forEach(function (warnId) {\n    warningsInfos[warnId] = warningInfoData[warnId]; // not async anymore, no Vue.set() necessay\n    // Vue.set(warningsInfos, warnId, warningInfoData[warnId]);\n  });\n}\nexport function selectSubTab(ind, shouldSetURL) {\n  //shouldSetURL should only be undefined when selectSubTab() is called from a route callback\n  //because then the route/URL is apparently already correct\n  appState.activeSubtab = ind; //import as appState, not as dataService.appState\n\n  console.log('selectSubTab ', ind);\n\n  if (shouldSetURL) {\n    dataService.rewriteURL();\n  }\n}\nexport function selectTab(ind, subtabInd, shouldSetURL) {\n  console.log('selectTab ', ind, appState.activeTab);\n\n  if (appState.activeTab === ind) {\n    //no need to start a fetch, if necessary just set the subtab (with updating the url) and exit\n    if (appState.activeSubtab !== subtabInd) {\n      selectSubTab(subtabInd, shouldSetURL);\n    } // console.log('selectTab exit');\n\n\n    return;\n  }\n\n  appState.activeTab = ind;\n  appState.activeSubtab = subtabInd;\n\n  if (appState.userAction.indexOf('tabChange') < 0) {\n    appState.userAction.push('tabChange');\n  } //shouldSetURL should only be false when selectTab() is called from certain route callbacks\n  //this function can be called from a user-action or from a route-callback, if called from a route-callback, a url-rewrite is unwanted\n\n\n  if (shouldSetURL) {\n    dataService.rewriteURL();\n  } //empty outputs object, but keep reference\n  //changing outputs won't trigger any sub-tab watches since they are not mounted due to appState.userAction === 'tabChange'\n\n\n  helpers.emptyObject(outputs);\n}\nexport function setCountryZoom(index) {\n  // console.log('setCountryZoom ', index);\n  appState.countryZoomIndex = index; // if index is out of bounds or not supported by current subtab,\n  // then it get's corrected in Outputs.vue on created() or on lastAPIResponse watch\n}\nexport function calculateNetZero() {\n  var nullStellenId = 'emissions-CO2e[Mt]';\n  var nullstellenOutput = outputs[nullStellenId];\n  var series = [{\n    id: nullStellenId,\n    data: nullstellenOutput.data['EU'].map(function (point) {\n      return {\n        y: point\n      };\n    })\n  }];\n\n  var _findNullstellen = findNullstellen(nullstellenOutput.timeAxis, series),\n      _findNullstellen2 = _slicedToArray(_findNullstellen, 2),\n      nullstellen = _findNullstellen2[0],\n      nullStellenBySeriesId = _findNullstellen2[1];\n\n  if (nullStellenBySeriesId && Object.prototype.hasOwnProperty.call(nullStellenBySeriesId, nullStellenId) && nullStellenBySeriesId[nullStellenId][0]) {\n    Vue.set(netZeroYear, 'value', Math.floor(nullStellenBySeriesId[nullStellenId][0]));\n  } else {\n    Vue.set(netZeroYear, 'value', 0);\n  }\n}\nexport function parseOutputs(raw) {\n  raw.forEach(function (outpt) {\n    //if output still undefined\n    if (!outputs[outpt.id]) {\n      Vue.set(outputs, outpt.id, {});\n      var title = outpt.title;\n      Vue.set(outputs[outpt.id], 'title', title ? title : outpt.id); //initialise title with id as fallback\n    } //initially timeAxis is not present, so use Vue.set()\n\n\n    Vue.set(outputs[outpt.id], 'timeAxis', outpt.timeAxis);\n    Vue.set(outputs[outpt.id], 'data', outpt.data);\n  }); //console.log('parseOutputs ', outputs);\n}\nexport function parseWarnings(warns) {\n  var levelWords = [\"orange\", \"red\"]; // clear warnings object\n  // not actually necessary in the current code, but feels safer regarding future changes\n\n  helpers.emptyReactiveObject(warnings); // clear the reactive tabsWithWarnings array first\n  // don't assign a new array, because that would kill the reactivity\n\n  helpers.emptyArray(tabsWithWarnings);\n  warns.forEach(function (wrng) {\n    var id = wrng.id;\n\n    if (!id) {\n      return;\n    }\n\n    var level = parseInt(wrng.level);\n\n    if ([1, 2].indexOf(level) < 0) {\n      return;\n    }\n\n    level = levelWords[level - 1];\n    warnings[id] = level; // console.log('warningsInfos ', warningsInfos, id, warns);\n\n    var warningInfo = warningsInfos[id];\n\n    if (warningInfo && warningInfo.tabs) {\n      warningInfo.tabs.forEach(function (tab) {\n        if (tabsWithWarnings.indexOf(tab) < 0) {\n          tabsWithWarnings.push(tab);\n        }\n      });\n    }\n  });\n}",{"version":3,"sources":["/Users/paruta/2050-Calculators/EUcalc/paris-tool/transition-pathway-explorer/src/outputsService.js"],"names":["Vue","helpers","findNullstellen","dataService","appState","tabs","chartDefinitions","outputsByTabs","outputs","netZeroYear","value","routes","tabRoutes","warningsInfos","warnings","tabsWithWarnings","outputsThatAreAlwaysRequested","outputModifiers","round","Math","zoomableComponents","chartTypeToComponentMap","getOutputList","outputPoolObject","forEach","tab","Object","keys","chartId","chart","output","id","outp","console","log","JSON","stringify","initChartsForTab","tabIndex","chartDefs","createRowInOutputsByTab","isObject","sortOutputIntoOutputsByTabs","push","modifier","allCountries","initSubtabsOfTab","subtabs","map","subtab","component","charts","length","initTabs","tabData","allTabDetails","tabObj","title","route","detailsKey","tabDetails","initTabRoutes","index","subTabIndex","initWarningsInfos","warningInfoData","warnId","selectSubTab","ind","shouldSetURL","activeSubtab","rewriteURL","selectTab","subtabInd","activeTab","userAction","indexOf","emptyObject","setCountryZoom","countryZoomIndex","calculateNetZero","nullStellenId","nullstellenOutput","series","data","point","y","timeAxis","nullstellen","nullStellenBySeriesId","prototype","hasOwnProperty","call","set","floor","parseOutputs","raw","outpt","parseWarnings","warns","levelWords","emptyReactiveObject","emptyArray","wrng","level","parseInt","warningInfo"],"mappings":"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","sourcesContent":["import Vue from \"vue\";\nimport * as helpers from './helpers.js';\nimport {findNullstellen} from './chartSeriesBuilders.js';\n\nimport * as dataService from './dataService.js';\nimport {appState} from './dataService.js';\n\nexport var tabs; // necessary for tab-menu and holding subtab information\n\n// the chart identifiers only need to be unique inside their tab\nexport var chartDefinitions = [];\n\nexport var outputsByTabs = []; // necessary for fetching\nexport var outputs = {};  // holding the API response data\n\nexport var netZeroYear = {\n  value: 0\n}; // made reactive in EmissionsBar.vue\n\nexport var routes = {};    // tab-indices of routes\nexport var tabRoutes = {}; // routes of tab-indices\n\nexport var warningsInfos = {};\nexport var warnings = {\n  // // structure example:\n  // \"warningId\": \"orange\", //or 1/2\n  // development data:\n  // \"Water scarcity\": \"orange\",\n  // \"Drought risk\": \"red\"\n}; //reactive data!!\n\n//don't write warnings into tabs Object, keep it separate\nexport var tabsWithWarnings = []; //reactive\n\nexport var outputsThatAreAlwaysRequested = [\n  \"clt_cum-emissions-CO2e[Mt]\",\n  \"emissions-CO2e[Mt]\"\n];\n\nvar outputModifiers = {\n  round: (value) => Math.round(value)\n};\n\n// countryzoom can also be disabled for an individual subtab with the countryZoomDisabled flag inside\n// the subtab definitions\nexport var zoomableComponents = [\n  'OneChart',\n  'TwoCharts',\n  'GHGEmissions',\n  'ChangePerSector',\n  'WagesPerSkill'\n  // 'SingleStackedArea',\n  // 'SingleLineChart',\n  // 'SingleStackedAreaWithNegative',\n  // 'SingleStackedAreaPercent',\n  // 'TwoStackedArea',\n  // 'TwoStackedArea100Percent',\n  // 'TwoStackedAreaSideBySide'\n];\n\nexport var chartTypeToComponentMap = {\n  \"Line\": \"LineChart\",\n  \"StackedArea\": \"StackedAreaChart\",\n  \"StackedAreaNegative\": \"StackedAreaChart\",\n  \"StackedAreaPercent\": \"StackedAreaChart100Percent\"\n}\n\nexport function getOutputList() {\n  var outputPoolObject = {};\n\n  chartDefinitions.forEach((tab) => {\n    Object.keys(tab).forEach((chartId) => {\n      let chart = tab[chartId];\n      // console.log('chart ', tab, chart);\n      chart.outputs.forEach((output) => {\n        outputPoolObject[output.id] = true;\n      });\n    });\n  });\n\n  outputsThatAreAlwaysRequested.forEach((outp) => {\n    outputPoolObject[outp] = true;\n  })\n\n  console.log(\"getOutputList \", JSON.stringify(Object.keys(outputPoolObject),null,2));\n}\n\nfunction initChartsForTab(tabIndex, chartDefs) {\n  chartDefinitions[tabIndex] = {};\n\n  // outputsByTab need to hold at least en empty object for each tab\n  createRowInOutputsByTab(tabIndex);\n\n  Object.keys(chartDefs).forEach((chartId)=> {\n    let chart = chartDefs[chartId];\n\n    // convert output-string-array elements to objects\n    let outputs = [];\n    chart.outputs.forEach((outp) => {\n      let output;\n\n      if(helpers.isObject(outp)) {\n        output = outp;\n      } else if (typeof outp === 'string') {\n        output = {id:outp};\n      }\n\n      if(!output) {\n        return;\n      }\n\n      sortOutputIntoOutputsByTabs(tabIndex, output);\n\n      outputs.push(output);\n    });\n    chart.outputs = outputs;\n\n    // replace modifier string (if present) with modifier-function\n    if(chart.modifier) {\n      if(outputModifiers[chart.modifier]) {\n        chart.modifier = outputModifiers[chart.modifier];\n      } else {\n        delete chart.modifier;\n      }\n    }\n\n    // add chart to chartDefinitions\n    chartDefinitions[tabIndex][chartId] = chart;\n  });\n}\n\nfunction createRowInOutputsByTab(tabIndex) {\n  outputsByTabs[tabIndex] = {};\n}\n\nfunction sortOutputIntoOutputsByTabs(tabIndex, outp) {\n  // don't overwrite existing entries (we don't want to lose any allCountries flags)\n  if(!outputsByTabs[tabIndex][outp.id]) {\n    outputsByTabs[tabIndex][outp.id] = {};\n  }\n  if(outp.allCountries === true) {\n    //won't be unset once it is set\n    outputsByTabs[tabIndex][outp.id].allCountries = true;\n  }\n  // if(outp.color) {\n  //   outputsByTabs[tabIndex][outp.id].color = outp.color;\n  // }\n}\n\nfunction initSubtabsOfTab(subtabs) {\n  return subtabs.map((subtab) => {\n    // don't overwrite existing component properties (these are for custom components)\n    if(!subtab.component) {\n      if(subtab.charts.length === 1) {\n        subtab.component = 'OneChart'\n      }\n      else if(subtab.charts.length === 2) {\n        subtab.component = 'TwoCharts'\n      }\n    }\n    return subtab;\n  });\n}\n\nexport function initTabs(tabData, allTabDetails) {\n  tabs = [];\n\n  tabData.forEach((tab, tabIndex) => {\n    let tabObj = {\n      title: tab.title,\n      route: tab.route,\n      subtabs: []\n    };\n    tabs.push(tabObj);\n\n    let detailsKey = tab.detailsKey;\n    if(!detailsKey) {\n      return;\n    }\n\n    // get subtab-information\n    let tabDetails = allTabDetails[detailsKey];\n    if(!tabDetails) {\n      return;\n    }\n\n    // init all charts for that tab (not subtab)\n    initChartsForTab(tabIndex, tabDetails.charts);\n\n    // determine component for subtab\n    tabObj.subtabs = initSubtabsOfTab(tabDetails.subtabs);\n  });\n  console.log(\"initTabs\", tabs, outputsByTabs);\n}\n\nexport function initTabRoutes() {\n\n  tabs.forEach((tab, tabIndex) => {\n    routes[tab.route] = {index: tabIndex};\n    tabRoutes[tabIndex] = {\"route\": tab.route};\n    tab.subtabs.forEach(function(subtab, subTabIndex) {\n      routes[tab.route][subtab.route]={index: subTabIndex};\n      tabRoutes[tabIndex][subTabIndex] = {\"route\": subtab.route};\n    });\n  });\n\n}\n\nexport function initWarningsInfos(warningInfoData) {\n  console.log('initWarningsInfos ', warningInfoData)\n  // warningsInfos = wrngs;\n  Object.keys(warningInfoData).forEach((warnId) => {\n    warningsInfos[warnId] = warningInfoData[warnId];\n    // not async anymore, no Vue.set() necessay\n    // Vue.set(warningsInfos, warnId, warningInfoData[warnId]);\n  });\n}\n\nexport function selectSubTab(ind, shouldSetURL) {\n  //shouldSetURL should only be undefined when selectSubTab() is called from a route callback\n  //because then the route/URL is apparently already correct\n  appState.activeSubtab = ind; //import as appState, not as dataService.appState\n  console.log('selectSubTab ', ind)\n  if(shouldSetURL) {\n    dataService.rewriteURL();\n  }\n}\n\nexport function selectTab(ind, subtabInd, shouldSetURL) {\n\n  console.log('selectTab ', ind, appState.activeTab);\n\n  if(appState.activeTab === ind) {\n    //no need to start a fetch, if necessary just set the subtab (with updating the url) and exit\n    if(appState.activeSubtab !== subtabInd) {\n      selectSubTab(subtabInd, shouldSetURL);\n    }\n    // console.log('selectTab exit');\n    return;\n  }\n\n  appState.activeTab = ind;\n  appState.activeSubtab = subtabInd;\n\n  if(appState.userAction.indexOf('tabChange') < 0) {\n    appState.userAction.push('tabChange');\n  }\n\n  //shouldSetURL should only be false when selectTab() is called from certain route callbacks\n  //this function can be called from a user-action or from a route-callback, if called from a route-callback, a url-rewrite is unwanted\n  if(shouldSetURL) {\n    dataService.rewriteURL();\n  }\n\n  //empty outputs object, but keep reference\n  //changing outputs won't trigger any sub-tab watches since they are not mounted due to appState.userAction === 'tabChange'\n  helpers.emptyObject(outputs);\n}\n\nexport function setCountryZoom(index) {\n  // console.log('setCountryZoom ', index);\n  appState.countryZoomIndex = index;\n  // if index is out of bounds or not supported by current subtab,\n  // then it get's corrected in Outputs.vue on created() or on lastAPIResponse watch\n}\n\nexport function calculateNetZero() {\n  let nullStellenId = 'emissions-CO2e[Mt]';\n\n  let nullstellenOutput = outputs[nullStellenId];\n\n  let series = [{\n    id: nullStellenId,\n    data: nullstellenOutput.data['EU'].map((point) => {return {y:point};})\n  }];\n\n  let [nullstellen, nullStellenBySeriesId] = findNullstellen(nullstellenOutput.timeAxis, series);\n\n  if(\n    nullStellenBySeriesId &&\n    Object.prototype.hasOwnProperty.call(nullStellenBySeriesId, nullStellenId) &&\n    nullStellenBySeriesId[nullStellenId][0]\n  ) {\n    Vue.set(netZeroYear, 'value', Math.floor(nullStellenBySeriesId[nullStellenId][0]));\n  } else {\n    Vue.set(netZeroYear, 'value', 0);\n  }\n}\n\nexport function parseOutputs(raw) {\n  raw.forEach(function(outpt) {\n    //if output still undefined\n    if(!outputs[outpt.id]) {\n      Vue.set(outputs, outpt.id, {});\n      let title = outpt.title;\n      Vue.set(outputs[outpt.id], 'title', title ? title : outpt.id); //initialise title with id as fallback\n    }\n    //initially timeAxis is not present, so use Vue.set()\n    Vue.set(outputs[outpt.id], 'timeAxis', outpt.timeAxis);\n\n    Vue.set(outputs[outpt.id], 'data', outpt.data);\n  });\n  //console.log('parseOutputs ', outputs);\n}\n\nexport function parseWarnings(warns) {\n\n  let levelWords = [\"orange\", \"red\"];\n\n  // clear warnings object\n  // not actually necessary in the current code, but feels safer regarding future changes\n  helpers.emptyReactiveObject(warnings);\n\n  // clear the reactive tabsWithWarnings array first\n  // don't assign a new array, because that would kill the reactivity\n  helpers.emptyArray(tabsWithWarnings);\n\n  warns.forEach((wrng) => {\n    let id = wrng.id;\n    if(!id) {\n      return;\n    }\n    let level = parseInt(wrng.level);\n\n    if([1,2].indexOf(level) < 0) {\n      return;\n    }\n\n    level = levelWords[level-1];\n    warnings[id] = level;\n    // console.log('warningsInfos ', warningsInfos, id, warns);\n\n    let warningInfo = warningsInfos[id];\n    if(warningInfo && warningInfo.tabs) {\n      warningInfo.tabs.forEach((tab)=> {\n        if(tabsWithWarnings.indexOf(tab) < 0) {\n          tabsWithWarnings.push(tab);\n        }\n      });\n    }\n  });\n}\n"]}]}